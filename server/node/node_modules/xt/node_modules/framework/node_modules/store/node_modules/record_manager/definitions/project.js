
// require some core modules
var UTIL    = require("util");
var PATH    = require("path");

// load into module namespace from above
require("tools");
require("exception");
require("store");

// load into module namespace from level
require("record");

XT.Project = XT.Record.extend({

  definition: {

    // sproutcore record equivalent
    sctype: "XT.Project",

    // postgres table
    table: "prj",

    // postgres schema
    schema: "public",

    // postgres sequence for guid/id
    sequence: "prj_prj_id_seq",

    // fields as columns
    fields: {
      
      //....................................
      // sproutcore fields

      guid:             "prj_id",

      number:           "prj_number",

      name:             "prj_name",

      stage:            "prj_status",

      startDate:        "prj_start_date",

      dueDate:          "prj_due_date",

      assignDate:       "prj_assigned_date",

      completeDate:     "prj_completed_date",

      notes:            "prj_descrip",

      salesOrder:       "prj_so",

      workOrder:        "prj_wo",

      purchaseOrder:    "prj_po",

      recurrenceParent: "prj_recurring_prj_id",

      owner:            "prj_owner_username",

      assignedTo:       "prj_username"

    },

    //....................................
    // toMany mappings
                              
    toMany: {

      tasks:     XT.Record.toMany({
        self:     "XT.Project",
        relation: "XT.ProjectTask",
        on:       "guid",
        to:       "project"
      }),

      comments:     XT.Record.toMany({
        self:     "XT.Project",
        relation: "XT.ProjectComment",
        on:       "guid",
        to:       "source",
        static:   XT.Record.static({ "comment_source":"'J'" })
      })

    }

  }, // definition

  /** @private */
  xtClass: "XT.Project",

});

XT.Store.recordManager.emit("definitionLoaded", XT.Project);


// require some core modules
var UTIL    = require("util");
var PATH    = require("path");

// load into module namespace from above
require("tools");
require("exception");
require("store");

// load into module namespace from level
require("record");

XT.CrmAccount = XT.Record.extend({

  definition: {

    // sproutcore record equivalent
    sctype: "XT.CrmAccount",

    // postgres table
    table: "crmacct",

    // postgres schema
    schema: "public",

    // postgres sequence
    sequence: "crmacct_crmacct_id_seq",

    // fields as columns
    fields: {
      
      //....................................
      // sproutcore fields

      guid:             "crmacct_id",
    
      number:           "crmacct_number",

      name:             "crmacct_name",

      active:           "crmacct_active",

      type:             "crmacct_type",

      notes:            "crmacct_notes",

      primaryContact:   "crmacct_cntct_id_1",

      secondaryContact: "crmacct_cntct_id_2",

      customer:         "crmacct_cust_id",

      prospect:         "crmacct_prospect_id",

      vendor:           "crmacct_vend_id",

      parent:           "crmacct_parent_id",

      taxAuthority:     "crmacct_taxauth_id",

      partner:          "crmacct_partner_id",

      competitor:       "crmacct_competitor_id",

      owner:            "crmacct_owner_username"

    },
     
    //....................................
    // toMany mappings

    toMany: {
          
      characteristics:  XT.Record.toMany({
                        self:     "XT.CrmAccount",
                        relation: "XT.CrmAccountCharacteristic",
                        on:       "guid",
                        to:       "target",
                        static:   XT.Record.static({ "charass_target_type":"'CRMACCT'" }),
                      }),

      comments:     XT.Record.toMany({
                      self:     "XT.CrmAccount",
                      relation: "XT.CrmAccountComment",
                      on:       "guid",
                      to:       "source"
                    }),

      contacts:     XT.Record.toMany({
                      self:     "XT.CrmAccount",
                      relation: "XT.Contact",
                      on:       "guid",
                      to:       "crmAccount",
                    })

    }

  }, // definition

  /** @private */
  xtClass: "XT.CrmAccount",

});

XT.Store.recordManager.emit("definitionLoaded", XT.CrmAccount);


// require some core modules
var UTIL    = require("util");
var PATH    = require("path");

// load into module namespace from above
require("tools");
require("exception");
require("store");

// load into module namespace from level
require("record");

XT.Incident = XT.Record.extend({

  definition: {

    // sproutcore record equivalent
    sctype: "XT.Incident",

    // postgres table
    table: "incdt",

    // postgres schema
    schema: "public",

    // postgres sequence for guid/id
    sequence: "incdt_incdt_id_seq",

    // fields as columns
    fields: {
      
      //....................................
      // sproutcore fields

      guid:         "incdt_id",

      number:       "incdt_number",

      name:         "incdt_summary",

      isPublic:     "incdt_public",

      stage:        "incdt_status",

      startDate:    "incdt_timestamp",

      notes:        "incdt_descrip",

      owner:        "incdt_owner_username",

      assignedTo:   "incdt_assigned_username",

      priority:     "incdt_incdtpriority_id",

      category:     "incdt_incdtcat_id",

      crmAccount:   "incdt_crmacct_id",

      severity:     "incdt_incdtseverity_id",

      resolution:   "incdt_incdtresolution_id",

      contact:      "incdt_cntct_id",

      project:      "incdt_prj_id",

      item:         "incdt_item_id",

      receivable:   "incdt_aropen_id",

      recurrenceParent: "incdt_recurring_incdt_id"

    },

    //....................................
    // toMany mappings
                              
    toMany: {

      comments:     XT.Record.toMany({
        self:     "XT.Incident",
        relation: "XT.IncidentComment",
        on:       "guid",
        to:       "source",
        static:   XT.Record.static({ "comment_source":"'INCDT'" }),
      }),

      characteristics:  XT.Record.toMany({
        self:     "XT.Incident",
        relation: "XT.CharacteristicAssignment",
        on:       "guid",
        to:       "target",
        static:   XT.Record.static({ "charass_target_type":"'INCDT'" }),
      })

    },

  }, // definition

  /** @private */
  xtClass: "XT.Incident",

});

XT.Store.recordManager.emit("definitionLoaded", XT.Incident);
